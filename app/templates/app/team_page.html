{% extends "base.html" %}
{% load static %}
{% comment %} 

OBJECTIVE:
Place Holder for "base.html" and static objects
{% extends "base.html" %}
{% load static %} 

STAUTS:
base.html and static are in development

{% endcomment %}

{% block title %}Wavelength{% endblock %}
{% block page_title %} Team Room {% endblock %}
{% block body %} 
{% comment %} {{request.get_full_path}} {% endcomment %}

<div class="container">
    <div class="bs-docs-section">
      <div class="page header">
        <div class="row">
            <div class="col-lg-15">
                {% comment %} TEAM_NAME is a place holder for team name this may change into a form {% endcomment %}
                <h2> Welcome </h2>
                <h1> Your team members are: </h2>
            </div>
        </div>  
      </div>
    </div>
    {% comment %} the teams context will be sorted from the views {% endcomment %}
        {% for player in teammates %}
            <div class="bs-component">  
                <div  class="row">
                    <div class="col-1">
                        <h3> {{ player.username }} </h3>
                        <h3> {{ player.team.name }} </h3>
                    </div>
                </div>
            </div>    
        {% endfor %}

        <div style='padding:10px ; text-align:center'>
            {% comment %} <button href="{% url 'app:start_page' %}" >Leave Room</button> {% endcomment %}
            <a>
            <button id='start_game_btn' type="submit" {% if player.is_host == False %}style='display:none'{%endif%}>Start Game!</button>
            </a>
        </div>

        {{ game_id|json_script:'json-game-id' }}
        {{ player.username|json_script:'json-username' }}

<script>
    const gameID = JSON.parse(document.getElementById('json-game-id').textContent);
    const userName = JSON.parse(document.getElementById('json-username').textContent);
    const start_game_btn = document.getElementById('start_game_btn');

    document.addEventListener('DOMContentLoaded', () => {
        const sessionSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/game_session/'
            + gameID
          );

        sessionSocket.onmessage = function(e) {
            console.log('onmessage');
            const data = JSON.parse(e.data);
            console.log(data);            
            if (data.message == 'start game'){
              console.log('game started!')
              {% comment %} window.location.href = "{% url 'app:question_clue_spectrum' game_id=game.id player_id=player.id %}"; {% endcomment %}
            }            
        };
        
        sessionSocket.onclose = (e) => {
          console.error('The socket closed unexpectedly');
          };

        const start_game_btn = document.getElementById('start_game_btn');
        start_game_btn.onclick = (e) =>{
          message='start game'
          sessionSocket.send(JSON.stringify({
            'message': message,
            'username': userName,
            'room': gameID,
          }));
        };
    });
</script>
{% endblock %}